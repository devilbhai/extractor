name: Run Maps Scraper and POST CSV

on:
  repository_dispatch:
    types: [run-scraper]

jobs:
  run-maps-scraper:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Install dependencies
        run: |
          npm install puppeteer
          npm install form-data

      - name: Run scraper
        env:
          CALLBACK_URL: ${{ secrets.CALLBACK_URL }}
        run: |
          node scraper.js \
            --query="${{ github.event.client_payload.query }}" \
            --city="${{ github.event.client_payload.city }}" \
            --state="${{ github.event.client_payload.state }}" \
            --out=results.csv \
            --job_id="${{ github.event.client_payload.job_id }}"
